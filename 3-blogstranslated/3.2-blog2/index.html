<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="thienlh@thienlu.com"><link rel=icon href=../../images/favicon.png type=image/png><title>Blog 2 :: Internship Report</title>
<link href=../../css/nucleus.css?1765391755 rel=stylesheet><link href=../../css/fontawesome-all.min.css?1765391755 rel=stylesheet><link href=../../css/hybrid.css?1765391755 rel=stylesheet><link href=../../css/featherlight.min.css?1765391755 rel=stylesheet><link href=../../css/perfect-scrollbar.min.css?1765391755 rel=stylesheet><link href=../../css/auto-complete.css?1765391755 rel=stylesheet><link href=../../css/atom-one-dark-reasonable.css?1765391755 rel=stylesheet><link href=../../css/theme.css?1765391755 rel=stylesheet><link href=../../css/hugo-theme.css?1765391755 rel=stylesheet><link href=../../css/theme-workshop.css?1765391755 rel=stylesheet><script src=../../js/jquery-3.3.1.min.js?1765391755></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../3-blogstranslated/3.2-blog2/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../js/lunr.min.js?1765391755></script><script type=text/javascript src=../../js/auto-complete.js?1765391755></script><script type=text/javascript>var baseurl="https://domint1.github.io/FCJ-Internship-Report/"</script><script type=text/javascript src=../../js/search.js?1765391755></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-worklog/ title=Worklog class=dd-item><a href=../../1-worklog/><b>1. </b>Worklog
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/1-worklog/1.1-week1/ title="Week 1 Worklog" class=dd-item><a href=../../1-worklog/1.1-week1/><b>1.1. </b>Week 1 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.2-week2/ title="Week 2 Worklog" class=dd-item><a href=../../1-worklog/1.2-week2/><b>1.2. </b>Week 2 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.3-week3/ title="Week 3 Worklog" class=dd-item><a href=../../1-worklog/1.3-week3/><b>1.3. </b>Week 3 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.4-week4/ title="Week 4 Worklog" class=dd-item><a href=../../1-worklog/1.4-week4/><b>1.4. </b>Week 4 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.5-week5/ title="Week 5 Worklog" class=dd-item><a href=../../1-worklog/1.5-week5/><b>1.5. </b>Week 5 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.6-week6/ title="Week 6 Worklog" class=dd-item><a href=../../1-worklog/1.6-week6/><b>1.6. </b>Week 6 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.7-week7/ title="Week 7 Worklog" class=dd-item><a href=../../1-worklog/1.7-week7/><b>1.7. </b>Week 7 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.8-week8/ title="Week 8 Worklog" class=dd-item><a href=../../1-worklog/1.8-week8/><b>1.8. </b>Week 8 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.9-week9/ title="Week 9 Worklog" class=dd-item><a href=../../1-worklog/1.9-week9/><b>1.9. </b>Week 9 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.10-week10/ title="Week 10 Worklog" class=dd-item><a href=../../1-worklog/1.10-week10/><b>1.10. </b>Week 10 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.11-week11/ title="Week 11 Worklog" class=dd-item><a href=../../1-worklog/1.11-week11/><b>1.11. </b>Week 11 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.12-week12/ title="Week 12 Worklog" class=dd-item><a href=../../1-worklog/1.12-week12/><b>1.12. </b>Week 12 Worklog
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/2-proposal/ title=Proposal class=dd-item><a href=../../2-proposal/><b>2. </b>Proposal
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/ title="Translated Blogs" class="dd-item
parent"><a href=../../3-blogstranslated/><b>3. </b>Translated Blogs
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/3-blogstranslated/3.1-blog1/ title="Blog 1" class=dd-item><a href=../../3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.2-blog2/ title="Blog 2" class="dd-item
active"><a href=../../3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=../../3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/4-eventparticipated/ title="Events Participated" class=dd-item><a href=../../4-eventparticipated/><b>4. </b>Events Participated
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/4-eventparticipated/4.1-event1/ title="Event 1" class=dd-item><a href=../../4-eventparticipated/4.1-event1/><b>4.1. </b>Event 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.2-event2/ title="Event 2" class=dd-item><a href=../../4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.3-event3/ title="Event 3" class=dd-item><a href=../../4-eventparticipated/4.3-event3/><b>4.3. </b>Event 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.4-event4/ title="Event 4" class=dd-item><a href=../../4-eventparticipated/4.4-event4/><b>4.4. </b>Event 4
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/ title=Workshop class=dd-item><a href=../../5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.1-workshop-overview/ title="Workshop Overview" class=dd-item><a href=../../5-workshop/5.1-workshop-overview/><b>5.1. </b>Workshop Overview
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.2-prerequiste/ title=Prerequiste class=dd-item><a href=../../5-workshop/5.2-prerequiste/><b>5.2. </b>Prerequiste
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-aws-cognito/ title="AWS Cognito Setup" class=dd-item><a href=../../5-workshop/5.3-aws-cognito/><b>5.3. </b>AWS Cognito Setup
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.3-aws-cognito/5.3.1-create-cognito/ title="Create a Cognito User Pool" class=dd-item><a href=../../5-workshop/5.3-aws-cognito/5.3.1-create-cognito/><b>5.3.1 </b>Create a Cognito User Pool
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-aws-cognito/5.3.2-configure-appclient/ title="Configure App Client" class=dd-item><a href=../../5-workshop/5.3-aws-cognito/5.3.2-configure-appclient/><b>5.3.2 </b>Configure App Client
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/5.4-next.js-setup/ title="Next.js Project Setup & Amplify Configuration" class=dd-item><a href=../../5-workshop/5.4-next.js-setup/><b>5.4. </b>Next.js Project Setup & Amplify Configuration
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.4-next.js-setup/5.4.1-install-nextjs/ title="Install Next.js Project" class=dd-item><a href=../../5-workshop/5.4-next.js-setup/5.4.1-install-nextjs/><b>5.4.1 </b>Install Next.js Project
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-next.js-setup/5.4.2-install-amplify/ title="Install Amplify SDK and Configure Amplify" class=dd-item><a href=../../5-workshop/5.4-next.js-setup/5.4.2-install-amplify/><b>5.4.2 </b>Install Amplify SDK and Configure Amplify
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/5.5-cognito-function/ title="Authentication Functions, UI, and Protected Routes" class=dd-item><a href=../../5-workshop/5.5-cognito-function/><b>5.5. </b>Authentication Functions, UI, and Protected Routes
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.5-cognito-function/5.5.1-auth-functions/ title="Create Authentication Functions" class=dd-item><a href=../../5-workshop/5.5-cognito-function/5.5.1-auth-functions/><b>5.5.1 </b>Create Authentication Functions
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.5-cognito-function/5.5.2-auth-ui/ title="Build Authentication UI" class=dd-item><a href=../../5-workshop/5.5-cognito-function/5.5.2-auth-ui/><b>5.5.2 </b>Build Authentication UI
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.5-cognito-function/5.5.3-protected-routes/ title="Implement Auth Context & Protected Routes" class=dd-item><a href=../../5-workshop/5.5-cognito-function/5.5.3-protected-routes/><b>5.5.3 </b>Implement Auth Context & Protected Routes
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.5-cognito-function/5.5.4-use-project-demo/ title="Use demo project for cognito authentication" class=dd-item><a href=../../5-workshop/5.5-cognito-function/5.5.4-use-project-demo/><b>5.5.4 </b>Use demo project for cognito authentication
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/5.6-testing/ title="Full Testing & Verification" class=dd-item><a href=../../5-workshop/5.6-testing/><b>5.6 </b>Full Testing & Verification
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.7-cleanup/ title="Clean Up Resources" class=dd-item><a href=../../5-workshop/5.7-cleanup/><b>5.7 </b>Clean Up Resources
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/6-self-evaluation/ title=Self-Assessment class=dd-item><a href=../../6-self-evaluation/><b>6. </b>Self-Assessment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/7-feedback/ title="Sharing and Feedback" class=dd-item><a href=../../7-feedback/><b>7. </b>Sharing and Feedback
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://domint1.github.io/FCJ-Internship-Report/3-blogstranslated/3.2-blog2/ selected>English</option><option id=vi value=https://domint1.github.io/FCJ-Internship-Report/vi/3-blogstranslated/3.2-blog2/>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=../../>Internship Report</a> > <a href=../../3-blogstranslated/>Translated Blogs</a> > Blog 2</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#introduction><strong>Introduction</strong></a></li><li><a href=#solution-overview><strong>Solution overview</strong></a></li><li><a href=#prerequisites><strong>Prerequisites</strong></a></li><li><a href=#deploy-the-solution-with-aws-cdk><strong>Deploy the Solution with AWS CDK</strong></a></li><li><a href=#walk-through-of-the-solution><strong>Walk-through of the solution</strong></a></li><li><a href=#detailed-explanation-of-trace-correlation><strong>Detailed Explanation of Trace Correlation</strong></a></li><li><a href=#understanding-distributed-tracing-concepts><strong>Understanding Distributed Tracing Concepts</strong></a></li><li><a href=#opentelemetry-collector-configuration><strong>OpenTelemetry Collector Configuration</strong></a></li><li><a href=#clean-up><strong>Clean up</strong></a></li><li><a href=#conclusion><strong>Conclusion</strong></a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 2</h1><h1 id=tracing-etl-workloads-using-aws-x-ray-and-aws-distro-for-opentelemetry>Tracing ETL Workloads using AWS X-Ray and AWS Distro for OpenTelemetry</h1><p>by Praneeth Reddy Tekula, Deepak Kovvuri, and Viveyk Karri on 30 APR 2025 in <a href=https://aws.amazon.com/blogs/mt/category/management-tools/aws-distro-for-opentelemetry/>AWS Distro for OpenTelemetry</a>, <a href=https://aws.amazon.com/blogs/mt/category/analytics/aws-glue/>AWS Glue</a>, <a href=https://aws.amazon.com/blogs/mt/category/developer-tools/aws-x-ray/>AWS X-Ray</a>, <a href=https://aws.amazon.com/blogs/mt/category/management-tools/>Management Tools</a>, <a href=https://aws.amazon.com/blogs/mt/category/post-types/technical-how-to/>Technical How-to</a> <a href=https://aws.amazon.com/blogs/mt/tracing-etl-workloads-using-aws-x-ray-and-aws-distro-for-opentelemetry/>Permalink</a> <a href=https://aws.amazon.com/vi/blogs/mt/tracing-etl-workloads-using-aws-x-ray-and-aws-distro-for-opentelemetry/>Share</a></p><h2 id=introduction><strong>Introduction</strong></h2><p>Data pipelines are essential for modern data-driven companies to gain critical business insights. However, data pipelines commonly fail when new files or datasets from data sources do not conform to the expected schema, leading to downstream job failures, workflow breakdowns, and delayed insights. Additionally, fluctuating data volumes, from a few gigabytes to multiple terabytes, can significantly impact the efficiency and reliability of these pipelines. This can make it challenging for customers to identify the specific ETL job within the data pipeline that failed.</p><p>To address these challenges, monitoring data pipelines in real-time and maintaining an end-to-end view is critical to identify issues early and minimize disruptions. In this blog post, we will explore how to orchestrate an end-to-end ETL pipeline using <a href=https://aws.amazon.com/glue>AWS Glue</a>, <a href=https://aws.amazon.com/pm/step-functions/>AWS Step Functions</a>, <a href=http://aws.amazon.com/s3>Amazon Simple Storage Service</a> (Amazon S3), <a href=https://aws.amazon.com/otel/>AWS Distro for OpenTelemetry</a> (ADOT) and <a href=https://aws.amazon.com/xray/>AWS X-ray</a>.</p><h2 id=solution-overview><strong>Solution overview</strong></h2><p>This solution addresses a data engineering use case with two-phase pipeline approach: –</p><ul><li>Data Cleaning: The data cleaning phase is handled by an ETL job to convert arbitrary data formats (CSV, JSON) to Parquet and performs various transformations, including standardizing column names, dropping unnecessary columns, removing duplicates, filling null values, converting data types, fixing skewness in certain columns.</li><li>Data Processing: Next, the data processing phase is handled by another ETL job that calculates, ranks and groups data.</li></ul><p>The data pipeline is orchestrated end to end using AWS Step Functions, leveraging AWS Glue for ETL jobs that are instrumented with ADOT and custom X-ray helper model for comprehensive tracing. Figure (1) illustrates architectural components involved in the orchestration of an end-to-end ETL pipeline. Here’s how it works: –</p><ol><li>Upload a dataset, to the S3 bucket by creating a folder input.</li><li>This triggers lambda function, that starts a new X-Ray trace and invokes Step Function workflow by passing traceID and S3 object details as an input.</li><li>Step Function workflow passes this traceID as a parameter. Glue Jobs use X-ray helper module to retrieve the parent segment for the current job, and correlate with input traceID from step functions.</li><li>Glue Job – 1 fetches input data set from S3 bucket to perform data cleaning and uploads the output to the same bucket by creating a folder clean.</li><li>After completion of Glue Job -1, step function workflow triggers Glue Job – 2.</li><li>Glue Job – 2 fetches input data set from S3 bucket to perform data processing job and uploads the output to the same bucket by creating a folder processed.</li><li>Each Glue Job is instrumented with ADOT, to send collected trace data to OpenTelemetry Collector that is running as a sidecar on ECS.</li><li>OpenTelemetry Collector then pushes collected trace data to AWS X-Ray.</li></ol><figure class=img-box><img src=../../images/Blog2/Image-1.jpg alt="Solution Architecture"></figure><p style=text-align:center>Figure 1: Solution Architecture</p><p>By leveraging this solution, we maintain a single trace across the entire ETL pipeline that provides end to end visibility into the data processing workflow. Data engineers and MLOps professionals can gain deep insights, quickly identify bottlenecks or failures, and optimize their data processing workflows for improved efficiency and reliability.</p><h2 id=prerequisites><strong>Prerequisites</strong></h2><p>To deploy this solution, you need:</p><ul><li>An AWS account. If you don’t already have an AWS account, you can <a href=https://aws.amazon.com/>create one</a>.</li><li>An <a href=http://aws.amazon.com/iam>AWS Identity and Access Management (IAM)</a> role that launches <a href=http://aws.amazon.com/cloudformation>AWS CloudFormation</a> templates which creates IAM roles to access services such as <a href=https://aws.amazon.com/glue>AWS Glue</a>, <a href=https://aws.amazon.com/xray/>AWS X-Ray</a>, <a href=https://aws.amazon.com/step-functions/>AWS Step Functions</a>, <a href=https://aws.amazon.com/pm/lambda/>AWS Lambda</a>, <a href=https://aws.amazon.com/ecs/>Amazon ECS</a>, <a href=https://aws.amazon.com/cloud-map/>AWS CloudMap</a> and <a href=http://aws.amazon.com/s3>Amazon Simple Storage Service</a>.</li><li>Install <a href=https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html>AWS CLI.</a></li><li>Python 3.12 or later</li><li>Install <a href=https://docs.aws.amazon.com/cdk/v2/guide/getting_started.html#getting_started_install>AWS CDK</a>.</li></ul><h2 id=deploy-the-solution-with-aws-cdk><strong>Deploy the Solution with AWS CDK</strong></h2><p>We will use <a href=https://aws.amazon.com/cdk/>AWS CDK</a> to deploy the solution. CDK allows defining the infrastructure through a familiar programming language such as Python.</p><ul><li>Clone the repository.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/aws-samples/tracing-etl-workloads-otel.git cd tracing-etl-workloads-otel
</span></span></code></pre></div></li><li>Create and activate a virtual environment:<ul><li>For Linux and macOS.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 <span style=color:#ae81ff>\-</span>m venv .venv
</span></span><span style=display:flex><span>source .venv/bin/activate
</span></span></code></pre></div><ul><li>For Windows.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python <span style=color:#ae81ff>\-</span>m venv .venv
</span></span><span style=display:flex><span>.venv<span style=color:#ae81ff>\\</span>Scripts<span style=color:#ae81ff>\\</span>activate
</span></span></code></pre></div></li><li>Install dependencies.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip install <span style=color:#ae81ff>\-</span>r requirements.txt
</span></span></code></pre></div></li><li>Bootstrap the CDK environment (if not already done).<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cdk bootstrap
</span></span></code></pre></div></li><li>Deploy the stack.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cdk deploy
</span></span></code></pre></div></li></ul><p>This will create all the necessary resources, including S3 buckets, Glue jobs, Step Functions state machine, and Lambda function. Once, the solution is deployed, on your AWS CloudFormation console, you can find the deployed resources on the “OtelSolutionStack” CloudFormation stack resource section.</p><h2 id=walk-through-of-the-solution><strong>Walk-through of the solution</strong></h2><ul><li><p>Upload <a href=https://www.kaggle.com/datasets/arianazmoudeh/airbnbopendata>Airbnb sample dataset</a> to the S3 ingestion bucket under input prefix folder.</p><figure class=img-box><img src=../../images/Blog2/Image-2.png alt="Sample dataset uploaded to S3 bucket"></figure><p style=text-align:center>Figure 2: Sample dataset uploaded to S3 bucket</p></li><li><p>Wait for the AWS StepFunction state machine workflow to succeed.</p><figure class=img-box><img src=../../images/Blog2/Image-3.png alt="State machine workflow running Glue jobs"></figure><p style=text-align:center>Figure 3: State machine workflow running Glue jobs</p></li><li><p>Navigate to <a href="https://us-east-2.console.aws.amazon.com/cloudwatch/home?region=us-east-2#home:">AWS CloudWatch console.</a> Click on the “Xray traces” in left navigation pane and select the recent traceID.</p><figure class=img-box><img src=../../images/Blog2/Image-4.png alt="Trace retrieval on AWS X-ray"></figure><p style=text-align:center>Figure 4: Trace retrieval on AWS X-ray</p></li><li><p>A trace map is displayed by default. It is a visual, end-to-end representation of data flow through each component within the data pipeline<figure class=img-box><img src=../../images/Blog2/Image-5.png alt="Trace Map, an end to end representation of data flow"></figure></p><p style=text-align:center>Figure 5: Trace Map, an end to end representation of data flow.</p></li><li><p>Each component i.e., AWS Lambda, AWS Step Function, and AWS Glue will create its own segment within the trace.<figure class=img-box><img src=../../images/Blog2/Image-6.png alt="Segments in a trace"></figure></p><p style=text-align:center>Figure 6: Segments in a trace</p></li><li><p>You will see sub-segments under AWS Glue Segment because of the instrumentation done using AWS Distro for Open Telemetry.<figure class=img-box><img src=../../images/Blog2/Image-7.png alt="Sub-segments in AWS Glue Segment"></figure></p><p style=text-align:center>Figure 7: Sub-segments in AWS Glue Segment</p></li></ul><p>Figure 7: Sub-segments in AWS Glue Segment</p><p>This level of detail allows data engineers to identify which specific operation in a glue job is taking the most time.</p><h2 id=detailed-explanation-of-trace-correlation><strong>Detailed Explanation of Trace Correlation</strong></h2><p>The solution uses a custom X-Ray helper module to correlate traces across the ETL pipeline. Here’s how it works</p><ul><li><p>Glue Jobs:</p><ul><li><p>At the start of each Glue job, X-Ray helper module is used to retrieve the parent segment for the current job:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>xray_trace <span style=color:#f92672>=</span> xray_helper<span style=color:#f92672>.</span>XRayTrace(TRACE_ID) 
</span></span><span style=display:flex><span>parent_id <span style=color:#f92672>=</span> xray_trace<span style=color:#f92672>.</span>retrieve_segment_for_step(JOB_NAME)  
</span></span></code></pre></div></li><li><p>If a parent segment is found, a new ADOT context is created using the X-Ray propagator:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>carrier <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;X-Amzn-Trace-Id&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Root=</span><span style=color:#e6db74>{</span>xray_trace<span style=color:#f92672>.</span>trace_id<span style=color:#e6db74>}</span><span style=color:#e6db74>;Parent=</span><span style=color:#e6db74>{</span>parent_id<span style=color:#e6db74>}</span><span style=color:#e6db74>;Sampled=1&#34;</span>} 
</span></span><span style=display:flex><span>propagator <span style=color:#f92672>=</span> AwsXRayPropagator() context <span style=color:#f92672>=</span> propagator<span style=color:#f92672>.</span>extract(carrier<span style=color:#f92672>=</span>carrier)
</span></span></code></pre></div></li><li><p>The Glue job execution is wrapped in a span using this context:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>with</span> tracer<span style=color:#f92672>.</span>start_as_current_span(<span style=color:#e6db74>&#34;Glue Job Execution&#34;</span>, context<span style=color:#f92672>=</span>context, kind<span style=color:#f92672>=</span>trace<span style=color:#f92672>.</span>SpanKind<span style=color:#f92672>.</span>SERVER):     
</span></span><span style=display:flex><span><span style=color:#75715e># Job execution code</span>
</span></span></code></pre></div></li><li><p>Throughout the job, individual operations are wrapped in spans for detailed tracing:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>with</span> tracer<span style=color:#f92672>.</span>start_as_current_span(<span style=color:#e6db74>&#34;Read Data&#34;</span>, attributes<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;S3Path&#39;</span>: s3_path}):     
</span></span><span style=display:flex><span><span style=color:#75715e># Read data operation</span>
</span></span></code></pre></div></li></ul></li><li><p>Trace Emission:</p><ul><li>The ADOT instrumentation is configured to send trace data to the OpenTelemetry Collector running as a sidecar. The OpenTelemetry Collector then forwards the trace data to AWS X-Ray.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>processor <span style=color:#f92672>=</span> BatchSpanProcessor(OTLPSpanExporter(endpoint<span style=color:#f92672>=</span><span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;http://</span><span style=color:#e6db74>{</span>OTLP_ENDPOINT<span style=color:#e6db74>}</span><span style=color:#e6db74>:4318/v1/traces&#34;</span>)) 
</span></span><span style=display:flex><span>tracer_provider <span style=color:#f92672>=</span> TracerProvider(resource<span style=color:#f92672>=</span>resource, active_span_processor<span style=color:#f92672>=</span>processor)
</span></span></code></pre></div></li></ul></li></ul><p>By using this approach, we maintain a single trace across the entire ETL pipeline, from the initial S3 upload trigger through the Step Functions execution and individual Glue job runs.</p><h2 id=understanding-distributed-tracing-concepts><strong>Understanding Distributed Tracing Concepts</strong></h2><p>It’s important to understand some key concepts in distributed tracing:</p><ul><li><strong>Traces:</strong> A trace represents the entire journey of a request or operation as it moves through a distributed system. In our ETL pipeline, a trace begins when data is uploaded to S3 and ends when the final processed data is written to Amazon S3.</li><li><strong>Spans:</strong> Spans are the building blocks of a trace. Each span represents a unit of work or operation within the trace. For example, in our Glue jobs, we create spans for operations like “Read Data”, “Drop Columns”, or “Calculate Minimum Total Spend”. Spans have a start time, end time, and can include additional metadata like logs or tags. Example from our Glue job:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>with</span> tracer<span style=color:#f92672>.</span>start_as_current_span(<span style=color:#e6db74>&#34;Calculate Minimum Total Spend&#34;</span>): 
</span></span><span style=display:flex><span>spark_df <span style=color:#f92672>=</span> spark_df<span style=color:#f92672>.</span>withColumn(<span style=color:#e6db74>&#34;minimum_total_spend&#34;</span>, (col(<span style=color:#e6db74>&#34;price&#34;</span>) <span style=color:#f92672>+</span> col(<span style=color:#e6db74>&#34;service_fee&#34;</span>)) <span style=color:#f92672>*</span> col(<span style=color:#e6db74>&#39;minimum_nights&#39;</span>))
</span></span></code></pre></div><ul><li><p><strong>Parent-Child Relationships:</strong> Spans can have parent-child relationships, creating a hierarchical structure within a trace. In our solution, the overall Glue job execution is a parent span, while individual operations within the job are child spans.</p></li><li><p><strong>Segments:</strong> In AWS X-Ray, a segment is similar to a span, but represents a unit of work done by a single component in your application. In our case, each Lambda invocation, Step Functions execution, and Glue job run creates a segment.</p></li><li><p><strong>Subsegments:</strong> These are equivalent to child spans. They represent smaller units of work within a segment. In our Glue jobs, the individual operations we trace become subsegments in X-Ray.</p></li><li><p><strong>Trace Context Propagation:</strong> To maintain a single trace across different components of a distributed system, we need to propagate the trace context. This is what allows us to link the Lambda function, Step Functions execution, and Glue jobs into a single trace. We do this by passing the trace ID and parent segment ID between components. Example of propagating context in our Glue job:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>carrier <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;X-Amzn-Trace-Id&#39;</span>: <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Root=</span><span style=color:#e6db74>{</span>xray_trace<span style=color:#f92672>.</span>trace_id<span style=color:#e6db74>}</span><span style=color:#e6db74>;Parent=</span><span style=color:#e6db74>{</span>parent_id<span style=color:#e6db74>}</span><span style=color:#e6db74>;Sampled=1&#34;</span>}       
</span></span><span style=display:flex><span>propagator <span style=color:#f92672>=</span> AwsXRayPropagator()     
</span></span><span style=display:flex><span>context <span style=color:#f92672>=</span> propagator<span style=color:#f92672>.</span>extract(carrier<span style=color:#f92672>=</span>carrier)  
</span></span></code></pre></div><ul><li><strong>Attributes and Annotations:</strong> These are key-value pairs that provide additional context to spans or segments. We use these to add useful information like S3 paths, job names, or data statistics. Example from our code:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>with</span> tracer<span style=color:#f92672>.</span>start_as_current_span(<span style=color:#e6db74>&#34;Glue Job Execution&#34;</span>, context<span style=color:#f92672>=</span>context, kind<span style=color:#f92672>=</span>trace<span style=color:#f92672>.</span>SpanKind<span style=color:#f92672>.</span>SERVER, attributes<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;job_name&#39;</span>: JOB_NAME, <span style=color:#e6db74>&#39;job_run_id&#39;</span>: JOB_RUN_ID})
</span></span></code></pre></div><ul><li><strong>Sampling:</strong> In high-volume systems, it’s often impractical to trace every single request. Sampling is the practice of only tracing a subset of requests. AWS X-Ray provides configurable sampling rules to control how much data you collect and store.</li></ul><h2 id=opentelemetry-collector-configuration><strong>OpenTelemetry Collector Configuration</strong></h2><p>A key component in our tracing setup is the OpenTelemetry Collector, which runs as a sidecar alongside Glue jobs. The collector is responsible for receiving trace data from our instrumented Glue jobs and forwarding it to AWS X-Ray.</p><p>Let’s break down the configuration file (otel-agent-config.yaml) that defines how the collector operates.</p><ul><li>Receivers:<ul><li>The collector is configured to receive OpenTelemetry Protocol (OTLP) data via both gRPC (port 4317) and HTTP (port 4318). This allows our Glue jobs to send trace data using either protocol.</li></ul></li><li>Exporters:<ul><li>The awsxray exporter is configured to send the collected trace data to AWS X-Ray. This is how our trace data ultimately ends up in X-Ray for visualization and analysis.</li></ul></li><li>Processors:<ul><li>A memory limiter processor is configured to prevent the collector from consuming too much memory. It’s set to limit memory usage to 100 MiB and check every 5 seconds.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>otlp</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>protocols</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>grpc</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>endpoint</span>: <span style=color:#ae81ff>0.0.0.0</span>:<span style=color:#ae81ff>4317</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>endpoint</span>: <span style=color:#ae81ff>0.0.0.0</span>:<span style=color:#ae81ff>4318</span>
</span></span><span style=display:flex><span><span style=color:#f92672>exporters</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>awsxray</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>region</span>: <span style=color:#ae81ff>us-east-2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>processors</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>memory_limiter</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>limit_mib</span>: <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>check_interval</span>: <span style=color:#ae81ff>5s</span>
</span></span><span style=display:flex><span><span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>pipelines</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>traces</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>processors</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>memory_limiter</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>receivers</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>otlp</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>exporters</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>awsxray</span>
</span></span></code></pre></div><p>This OpenTelemetry Collector configuration ensures the effective capture, processing, and export of trace data to AWS X-Ray for visibility and analysis of our data processing pipelines</p><h2 id=clean-up><strong>Clean up</strong></h2><p>You can either delete the stack through the <a href="https://us-east-2.console.aws.amazon.com/cloudformation/home?region=us-east-2#/stacks?filteringText=&filteringStatus=active&viewNested=true">CloudFormation console</a> or use AWS CDK destroy from the root folder.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cdk destroy
</span></span></code></pre></div><p>When deleting a stack, most resources will be deleted upon stack deletion, however that’s not the case for all resources. In this solution, lambda functions will generate <a href=https://aws.amazon.com/cloudwatch>Amazon CloudWatch</a> logs that are retained even after stack deletion. These won’t be tracked by CloudFormation because they’re not part of the stack, so the logs will persist. Follow steps <a href=https://docs.aws.amazon.com/solutions/latest/video-on-demand-on-aws-foundation/deleting-the-cloudwatch-logs.html>here</a>, to manually delete any logs that you don’t want to retain from CloudWatch console.</p><h2 id=conclusion><strong>Conclusion</strong></h2><p>This solution provides an end-to-end observability view of a data pipeline workflow by propagating context and tracing individual operations through AWS Distro for OpenTelemetry and AWS X-Ray. This enables data engineers to quickly troubleshoot failures, optimize performance, and gain insights into how data characteristics impact downstream processing. Such observability is crucial for modern data platforms involving complex, distributed workflows across multiple components and services.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../3-blogstranslated/3.1-blog1/ title="Blog 1"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=../../3-blogstranslated/3.3-blog3/ title="Blog 3" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../js/clipboard.min.js?1765391755></script><script src=../../js/perfect-scrollbar.min.js?1765391755></script><script src=../../js/perfect-scrollbar.jquery.min.js?1765391755></script><script src=../../js/jquery.sticky.js?1765391755></script><script src=../../js/featherlight.min.js?1765391755></script><script src=../../js/highlight.pack.js?1765391755></script><script>hljs.initHighlightingOnLoad()</script><script src=../../js/modernizr.custom-3.6.0.js?1765391755></script><script src=../../js/learn.js?1765391755></script><script src=../../js/hugo-learn.js?1765391755></script><link href=../../mermaid/mermaid.css?1765391755 rel=stylesheet><script src=../../mermaid/mermaid.js?1765391755></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>